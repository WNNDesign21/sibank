<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="input_MSO.css" />
  </head>
  <body>
    <header>
      <button class="hamburger" onclick="toggleSidebar()">â˜°</button>
      <div class="header-center">
        <h3>WENDI NUGRAHA N</h3>
        <p>IT Staff</p>
      </div>
      <img src="assets/pp.png" alt="Profile Picture" />
    </header>

    <aside id="sidebar" class="sidebar">
      <img src="assets/pp.png" alt="Profile Picture" />
      <div class="profile">
        <h2>WENDI NUGRAHA N</h2>
        <p>IT Staff</p>
      </div>
      <nav>
        <ul>
          <li><a href="dashboard2.html">Dashboard</a></li>
          <li><a href="">Memorandum SO</a></li>
          <li><a href="#">Memorandum AO</a></li>
          <li><a href="#">Memorandum HM</a></li>
          <li><a href="#">Memorandum BM</a></li>
          <li><a href="#">Memorandum CA</a></li>
          <li><a href="CAA.html">CAA</a></li>
        </ul>
      </nav>
      <button class="logout">Logout</button>
    </aside>

    <div class="container">
      <h2>MEMORANDUM SALES OFFICER</h2>
      <div class="section-title">MEMORANDUM SO</div>

      <form>
        <div class="form-row">
          <div class="form-group">
            <label>Sumber Aplikasi</label>
            <input
              type="text"
              id="sumber-aplikasi"
              class="form-control"
              placeholder="Mitra Bisnis"
            />
          </div>
          <div class="form-group">
            <label>Nama Sumber</label>
            <input
              type="text"
              id="nama-sumber"
              class="form-control"
              placeholder="Nama Mitra Bisnis"
            />
          </div>
          <div class="form-group">
            <label>Nama Sales Officer</label>
            <input
              type="text"
              id="nama-sales"
              class="form-control"
              placeholder="Nama Sales Officer"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Pengajuan</label>
            <input
              type="text"
              id="pengajuan"
              class="form-control"
              placeholder="Nominal Pengajuan"
              oninput="formatNumber(this)"
            />
          </div>
          <div class="form-group">
            <label>Tenor</label>
            <select id="tenor" class="form-select">
              <option value="6">6 Bulan</option>
              <option value="12">12 Bulan</option>
              <option value="24">24 Bulan</option>
              <option value="36">36 Bulan</option>
              <option value="48">48 Bulan</option>
              <option value="60">60 Bulan</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tujuan Pinjaman</label>
            <select id="tujuan" class="form-select">
              <option value="Konsumtif">Konsumtif</option>
              <option value="Investasi">Investasi</option>
              <option value="Liburan">Liburan</option>
              <option value="Pendidikan">Pendidikan</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Produk</label>
            <input
              type="text"
              id="produk"
              class="form-control"
              placeholder="Kredit Agunan Sertifikat"
            />
          </div>
          <div class="form-group">
            <label>Deskripsi</label>
            <input
              type="text"
              id="deskripsi"
              class="form-control"
              placeholder="Kredit Spesial Karyawan"
            />
          </div>
        </div>
      </form>
      <!-- Data PEMOHON Section -->

      <div class="section-title">DATA PEMOHOM</div>
      <div class="ocr">
        <input
          type="file"
          id="ktpImage"
          accept="image/*"
          class="form-control"
        />
        <button class="btn-primary" onclick="processOCR()">Proses OCR</button>
      </div>
      <!-- Hasil OCR -->
      <pre id="ocrResult" style="display: block"></pre>
      <form id="ktpForm">
        <div class="form-row">
          <div class="form-group">
            <label for="name">Nama:</label>
            <input type="text" id="name" name="name" class="form-control" />
          </div>
          <div class="form-group">
            <label for="nik">NIK:</label>
            <input type="text" id="nik" name="nik" class="form-control" />
          </div>
          <div class="form-group">
            <label for="birthPlaceDate">Tempat Lahir:</label>
            <input
              type="text"
              id="birthPlaceDate"
              name="birthPlaceDate"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tgl-lahir">Tanggal Lahir:</label>
            <input
              type="text"
              id="tgl-lahir"
              name="tgl-lahir"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="gender">Jenis Kelamin:</label>
            <input type="text" id="gender" name="gender" class="form-control" />
          </div>
          <div class="form-group">
            <label for="address">Alamat:</label>
            <textarea
              id="address"
              name="address"
              class="form-control"
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="desa">Desa/Kelurahan:</label>
            <input type="text" id="desa" name="desa" class="form-control" />
          </div>
          <div class="form-group">
            <label for="kecamatan">Kecamatan:</label>
            <input
              type="text"
              id="kecamatan"
              name="kecamatan"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="kabupatenKota">Kabupaten/Kota:</label>
            <input
              type="text"
              id="kabupatenKota"
              name="kabupatenKota"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="religion">Agama:</label>
            <input
              type="text"
              id="religion"
              name="religion"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="maritalStatus">Status Perkawinan:</label>
            <input
              type="text"
              id="maritalStatus"
              name="maritalStatus"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="job">Pekerjaan:</label>
            <input type="text" id="job" name="job" class="form-control" />
          </div>
          <div class="form-group">
            <label for="citizenship">Kewarganegaraan:</label>
            <input
              type="text"
              id="citizenship"
              name="citizenship"
              class="form-control"
            />
          </div>
        </div>

        <!-- Data PASANGAN PEMOHON -->
        <div class="section-title">DATA PASANGAN PEMOHOM</div>
      </form>
      <div class="ocr">
        <input
          type="file"
          id="ktpImage-psg"
          accept="image/*"
          class="form-control"
        />
        <button class="btn-primary" onclick="processOCRpsg()">
          Proses OCR
        </button>
      </div>
      <!-- Hasil OCR -->
      <pre id="ocrResult-psg" style="display: block"></pre>
      <form id="ktpForm">
        <div class="form-row">
          <div class="form-group">
            <label for="name-psg">Nama:</label>
            <input
              type="text"
              id="name-psg"
              name="name-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="nik-psg">NIK:</label>
            <input
              type="text"
              id="nik-psg"
              name="nik-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="birthPlaceDate-psg">Tempat Lahir:</label>
            <input
              type="text"
              id="birthPlaceDate-psg"
              name="birthPlaceDate-psg"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tgl-lahir-psg">Tanggal Lahir:</label>
            <input
              type="text"
              id="tgl-lahir-psg"
              name="tgl-lahir-psg"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="gender-psg">Jenis Kelamin:</label>
            <input
              type="text"
              id="gender-psg"
              name="gender-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="address-psg">Alamat:</label>
            <textarea
              id="address-psg"
              name="address-psg"
              class="form-control"
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="desa-psg">Desa/Kelurahan:</label>
            <input
              type="text"
              id="desa-psg"
              name="desa-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="kecamatan-psg">Kecamatan:</label>
            <input
              type="text"
              id="kecamatan-psg"
              name="kecamatan-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="kabupatenKota-psg">Kabupaten/Kota:</label>
            <input
              type="text"
              id="kabupatenKota-psg"
              name="kabupatenKota-psg"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="religion-psg">Agama:</label>
            <input
              type="text"
              id="religion-psg"
              name="religion-psg"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="job-psg">Pekerjaan:</label>
            <input
              type="text"
              id="job-psg"
              name="job-psg"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="citizenship-psg">Kewarganegaraan:</label>
            <input
              type="text"
              id="citizenship-psg"
              name="citizenship-psg"
              class="form-control"
            />
          </div>
        </div>
      </form>

      <!-- Lampiran Section -->

      <div class="section-title">LAMPIRAN</div>
      <div class="form-row">
        <div class="form-group">
          <div class="upload-box">
            <label for="ktpDebitur">Upload KTP Debitur</label>
            <input
              type="file"
              id="ktpDebitur"
              name="lampiran_ktp"
              accept="image/*"
            />
          </div>
        </div>
        <div class="form-group">
          <div class="upload-box">
            <label for="kkDebitur">Upload Kartu Keluarga</label>
            <input
              type="file"
              id="kkDebitur"
              name="lampiran_kk"
              accept="image/*"
            />
          </div>
        </div>
        <div class="form-group">
          <div class="upload-box">
            <label for="fotoDebitur">Upload Foto NPWP Debitur</label>
            <input
              type="file"
              id="npwpDebitur"
              name="lampiran_npwp_debitur"
              accept="image/*"
            />
          </div>
        </div>
        <div class="form-group">
          <div class="upload-box">
            <label for="fotoPasangan">Upload Foto Selfie Debitur</label>
            <input
              type="file"
              id="fotoDebitur"
              name="lampiran_foto_debitur"
              accept="image/*"
            />
          </div>
        </div>
      </div>
    </div>
    <!-- Save Button -->
    <div class="tombol">
      <button class="btn-primary">Save</button>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const hamburger = document.querySelector(".hamburger");
        sidebar.classList.toggle("sidebar-open");
        hamburger.classList.toggle("hamburger-open");
      }

      function processOCR() {
        const fileInput = document.getElementById("ktpImage").files[0];
        const apiKey = "K81624968088957"; // Ganti dengan API Key Anda

        if (!fileInput) {
          alert("Pilih gambar KTP terlebih dahulu!");
          return;
        }

        const formData = new FormData();
        formData.append("apikey", apiKey);
        formData.append("language", "eng"); // Menggunakan Bahasa Indonesia
        formData.append("file", fileInput);
        formData.append("isTable", true); // Mengaktifkan mode table recognition
        formData.append("scale", true); // Auto-enlarge content
        formData.append("OCREngine", 2); // Menggunakan OCR Engine 2

        fetch("https://api.ocr.space/parse/image", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.OCRExitCode === 1) {
              const parsedText = data.ParsedResults[0].ParsedText;
              document.getElementById("ocrResult").textContent = parsedText;

              // Memproses hasil OCR untuk diisi di form
              autofillForm(parsedText);
            } else {
              document.getElementById("ocrResult").textContent =
                "Error: " + data.ErrorMessage;
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("ocrResult").textContent =
              "Terjadi kesalahan saat melakukan OCR.";
          });
      }
      // s*[:;]? kode ini untuk menentukan titik dua, titik koma, dan spasi
      // s*([^\d]*) kode ini untuk menghilangkan angka

      function autofillForm(parsedText) {
        // Regex untuk mencari data berdasarkan label yang umum di KTP
        const nameMatch = parsedText.match(/Nama\s*[:;]?\s*(.*)/i);
        const nikMatch = parsedText.match(/NIK\s*[:;]?\s*(\d+)/i);
        const birthPlaceDateMatch = parsedText.match(
          /Tempat\/Tgl Lahir\s*[:;]?\s*([A-Za-z\s]+),\s*(\d{2}-\d{2}-\d{4})/i
        );

        const genderMatch = parsedText.match(
          /Jenis Kelamin\s*[:;]?\s*(Laki-Laki|Perempuan)/i
        );
        const addressMatch = parsedText.match(/Alamat\s*[:;]?\s*(.*)/i);
        const desaMatch = parsedText.match(/Kel\Desa\s*[:;]\s*(.*)/i);

        const kecamatanMatch = parsedText.match(/Kecamatan\s*[:;]\s*(.*)/i);
        const religionMatch = parsedText.match(/Agama\s*[:;]?\s*(.*)/i);
        const maritalStatusMatch = parsedText.match(
          /Status Perkawinan\s*[:;]?\s*(Kawin|Belum Kawin)/i
        );
        const jobMatch = parsedText.match(/Pekerjaan\s*[:;]?\s*([^\d]*)/i);
        const citizenshipMatch = parsedText.match(
          /Kewarganegaraan\s*[:;]?\s*(.*)/i
        );

        // Mencari kata "Kabupaten" atau "Kota" dan mengambil teks setelahnya
        const kabupatenKotaMatch = parsedText.match(
          /kabupaten\s+([a-zA-Z\s]+)\s+NIK/i
        );

        // Menyimpan hasil OCR ke dalam form
        document.getElementById("name").value = nameMatch ? nameMatch[1] : "";
        document.getElementById("nik").value = nikMatch ? nikMatch[1] : "";
        if (birthPlaceDateMatch) {
          const birthPlace = birthPlaceDateMatch[1].trim();
          document.getElementById("birthPlaceDate").value = `${birthPlace}`;
          const birthDate = birthPlaceDateMatch[2].trim();
          document.getElementById("tgl-lahir").value = `${birthDate}`;
        }

        document.getElementById("gender").value = genderMatch
          ? genderMatch[1]
          : "";
        document.getElementById("address").value = addressMatch
          ? addressMatch[1]
          : "";
        document.getElementById("desa").value = desaMatch ? desaMatch[1] : "";
        document.getElementById("kecamatan").value = kecamatanMatch
          ? kecamatanMatch[1]
          : "";

        // Mengisi kabupaten/kota dengan data setelah kata "Kabupaten" atau "Kota"
        document.getElementById("kabupatenKota").value = kabupatenKotaMatch
          ? kabupatenKotaMatch[1] // Mengambil teks setelah "Kabupaten" atau "Kota"
          : "";

        document.getElementById("religion").value = religionMatch
          ? religionMatch[1]
          : "";
        document.getElementById("maritalStatus").value = maritalStatusMatch
          ? maritalStatusMatch[1]
          : "";
        document.getElementById("job").value = jobMatch ? jobMatch[1] : "";
        document.getElementById("citizenship").value = citizenshipMatch
          ? citizenshipMatch[1]
          : "";
      }

      // PASANGAN
      function processOCRpsg() {
        const fileInput = document.getElementById("ktpImage-psg").files[0];
        const apiKey = "K81624968088957"; // Ganti dengan API Key Anda

        if (!fileInput) {
          alert("Pilih gambar KTP Pasangan terlebih dahulu!");
          return;
        }

        const formData = new FormData();
        formData.append("apikey", apiKey);
        formData.append("language", "eng"); // Menggunakan Bahasa Indonesia
        formData.append("file", fileInput);
        formData.append("isTable", true); // Mengaktifkan mode table recognition
        formData.append("scale", true); // Auto-enlarge content
        formData.append("OCREngine", 2); // Menggunakan OCR Engine 2

        fetch("https://api.ocr.space/parse/image", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.OCRExitCode === 1) {
              const parsedText = data.ParsedResults[0].ParsedText;
              document.getElementById("ocrResult-psg").textContent = parsedText;

              // Memproses hasil OCR untuk diisi di form
              autofillFormpsg(parsedText);
            } else {
              document.getElementById("ocrResult-psg").textContent =
                "Error: " + data.ErrorMessage;
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("ocrResult-psg").textContent =
              "Terjadi kesalahan saat melakukan OCR.";
          });
      }

      function autofillFormpsg(parsedText) {
        // Regex untuk mencari data berdasarkan label yang umum di KTP
        const nameMatch = parsedText.match(/Nama\s*[;:]?\s*(.*)/i);
        const nikMatch = parsedText.match(/NIK\s*[:;]?\s*(\d+)/i);
        const birthPlaceDateMatch = parsedText.match(
          /Tempat\/Tgl Lahir\s*[:;]?\s*([A-Za-z\s]+),\s*(\d{2}-\d{2}-\d{4})/i
        );

        const genderMatch = parsedText.match(
          /Jenis Kelamin\s*[:;]?\s*(Laki-Laki|Perempuan)/i
        );
        const addressMatch = parsedText.match(/Alamat\s*[:;]?\s*(.*)/i);
        const desaMatch = parsedText.match(/Kel\Desa\s*[:;]?\s*(.*)/i);
        const kecamatanMatch = parsedText.match(/Kecamatan\s*[:;]?\s*(.*)/i);
        const religionMatch = parsedText.match(/Agama\s*[:;]?\s*(.*)/i);
        const jobMatch = parsedText.match(/Pekerjaan\s*[:;]?\s*([^\d]*)/i);
        const citizenshipMatch = parsedText.match(
          /Kewarganegaraan\s*[:;]?\s*(.*)/i
        );

        // Mencari kata "Kabupaten" atau "Kota" dan mengambil teks setelahnya
        const kabupatenKotaMatch = parsedText.match(
          /kabupaten\s+([a-zA-Z\s]+)\s+NIK/i
        );

        // Menyimpan hasil OCR ke dalam form
        document.getElementById("name-psg").value = nameMatch
          ? nameMatch[1]
          : "";
        document.getElementById("nik-psg").value = nikMatch ? nikMatch[1] : "";
        if (birthPlaceDateMatch) {
          const birthPlace = birthPlaceDateMatch[1].trim();
          document.getElementById("birthPlaceDate-psg").value = `${birthPlace}`;
          const birthDate = birthPlaceDateMatch[2].trim();
          document.getElementById("tgl-lahir-psg").value = `${birthDate}`;
        }

        document.getElementById("gender-psg").value = genderMatch
          ? genderMatch[1]
          : "";
        document.getElementById("address-psg").value = addressMatch
          ? addressMatch[1]
          : "";
        document.getElementById("desa-psg").value = desaMatch
          ? desaMatch[1]
          : "";
        document.getElementById("kecamatan-psg").value = kecamatanMatch
          ? kecamatanMatch[1]
          : "";

        // Mengisi kabupaten/kota dengan data setelah kata "Kabupaten" atau "Kota"
        document.getElementById("kabupatenKota-psg").value = kabupatenKotaMatch
          ? kabupatenKotaMatch[1] // Mengambil teks setelah "Kabupaten" atau "Kota"
          : "";

        document.getElementById("religion-psg").value = religionMatch
          ? religionMatch[1]
          : "";
        document.getElementById("job-psg").value = jobMatch ? jobMatch[1] : "";
        document.getElementById("citizenship-psg").value = citizenshipMatch
          ? citizenshipMatch[1]
          : "";
      }
    </script>
  </body>
</html>
